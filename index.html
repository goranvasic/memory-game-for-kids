<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Memory game cards</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.jsdelivr.net/npm/@hiseb/confetti@2.1.0/dist/confetti.min.js"></script>

    <style>
        :root {
            --bg1: #0a3c54;
            --bg2: #072f43;
            --card: #eaf6ff;
            --title: #f2b21b;
            --btn: #2bd9c3;
            --btnText: #063a34;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: grid;
            place-items: center;
            font-family: system-ui, sans-serif;
            color: white;
            background: radial-gradient(1200px 600px at 20% 10%, rgba(255, 255, 255, .1), transparent 60%),
            linear-gradient(180deg, var(--bg1), var(--bg2));
        }

        .wrap {
            width: min(860px, 92vw);
            text-align: center;
            padding: 24px;
        }

        h1 {
            color: var(--title);
            font-size: clamp(28px, 5vw, 52px);
            margin: 0 0 12px;
            font-weight: 800;
        }

        .meta {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 12px;
        }

        .pill {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(255, 255, 255, .15);
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            max-width: 720px;
            margin: 0 auto;
        }

        .grid.hidden {
            display: none;
        }

        .card {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, .12);
            border-radius: 14px;
            display: grid;
            place-items: center;
            cursor: pointer;
            position: relative;
            overflow: visible;
            --front-color: var(--card);
        }

        .face {
            width: 82%;
            height: 82%;
            border-radius: 12px;
            display: grid;
            place-items: center;
            font-size: 40px;
            color: #0b2f3f;
            background: var(--front-color, var(--card));
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .card.hidden .face {
            background: rgba(255, 255, 255, .08);
            color: transparent;
        }

        .card.hidden .face::after {
            content: "â˜…";
            color: white;
            font-size: 24px;
        }

        .matched {
            pointer-events: none;
            filter: saturate(1.2);
        }

        .matched .face {
            animation: match-highlight 1s ease-out forwards;
        }

        @keyframes match-highlight {
            from {
                background-color: white;
            }
            to {
                background-color: color-mix(in srgb, var(--front-color), rgba(255, 255, 255, .08) 50%);
            }
        }

        .card-confetti {
            position: absolute;
            pointer-events: none;
            mix-blend-mode: screen;
            animation: firework-pop 1s ease-out forwards;
            filter: drop-shadow(0 0 12px rgba(255, 255, 255, .45));
        }

        @keyframes firework-pop {
            0% {
                transform: scale(.35);
                opacity: 0;
            }
            15% {
                opacity: 1;
            }
            100% {
                transform: scale(1.25);
                opacity: 0;
            }
        }

        button {
            margin-top: 14px;
            padding: 12px 18px;
            border-radius: 12px;
            border: none;
            background: var(--btn);
            color: var(--btnText);
            font-weight: 800;
            cursor: pointer;
        }

        .status {
            min-height: 20px;
            margin-top: 8px;
            font-size: 14px;
        }

        .final-score {
            display: none;
            max-width: 720px;
            margin: 0 auto;
            padding: 48px 24px;
            border-radius: 18px;
            background: rgba(0, 0, 0, .25);
            font-size: clamp(22px, 4vw, 40px);
            font-weight: 700;
        }

        .final-score.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 520px) {
            .grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="wrap">
    <h1>Memory game cards</h1>
    <div class="meta">
        <div class="pill">Moves: <span id="moves">0</span></div>
        <div class="pill">Matched: <span id="matched">0</span>/6</div>
    </div>
    <div id="grid" class="grid"></div>
    <div id="finalScore" class="final-score" aria-live="polite"></div>
    <div id="status" class="status"></div>
    <button id="restartBtn">Restart game</button>
</div>

<script>

    const PAIRS = 6, PREVIEW_SEC = 3.5, MISMATCH_SEC = 0.6;
    const SYMBOLS = ["ðŸ¥¦", "ðŸ‹", "ðŸ¥•", "ðŸ§…", "ðŸ¥¬", "ðŸŠ"];
    const COLORS = ["#4FE0C1", "#FFF6B3", "#E27BB9", "#eaead6", "#6EB6E8", "#E6A08A"];
    const COLOR_MAP = Object.fromEntries(SYMBOLS.slice(0, PAIRS).map((s, i) => [s, COLORS[i]]));

    let deck = [], revealed = new Set(), matched = new Set(), firstPick = null, lock = false, moves = 0;
    const els = {
        grid: document.getElementById("grid"), moves: document.getElementById("moves"),
        matched: document.getElementById("matched"), status: document.getElementById("status"),
        score: document.getElementById("finalScore")
    };

    const sleep = s => new Promise(r => setTimeout(r, s * 1000));
    const updateMeta = () => {
        els.moves.textContent = moves;
        els.matched.textContent = matched.size / 2;
    };
    const setStatus = t => els.status.textContent = t;
    const cardEl = idx => els.grid.querySelector(`[data-idx="${idx}"]`);
    const toggle = (idx, hide) => cardEl(idx)?.classList.toggle("hidden", hide);

    function newDeck() {
        const d = [...SYMBOLS.slice(0, PAIRS), ...SYMBOLS.slice(0, PAIRS)];
        for (let i = d.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [d[i], d[j]] = [d[j], d[i]];
        }
        return d;
    }

    function render() {
        els.grid.innerHTML = deck.map((sym, i) => `
        <div class="card hidden" data-idx="${i}" style="--front-color: ${COLOR_MAP[sym]}">
          <div class="face">${sym}</div>
        </div>`).join('');
    }

    function runConfetti(xPos, yPos, count = 25) {
        confetti({
            position: {x: xPos, y: yPos},	// Origin position
            count: count,			// Number of particles
            size: 1,			// Size of the particles
            velocity: 100,		// Initial particle velocity
            fade: true,			// Particles fall off the screen, or fade out
        });
    }

    async function resolve(i, j) {
        lock = true;
        moves++;
        updateMeta();
        if (deck[i] === deck[j]) {
            matched.add(i);
            matched.add(j);
            updateMeta();
            [i, j].forEach(k => {
                toggle(k, false);
                const c = cardEl(k);
                c.classList.add("matched");
                const r = c.getBoundingClientRect();
                runConfetti(r.left + r.width / 2, r.top + r.height / 2);
            });
            setStatus("Match!");
        } else {
            setStatus("Nope.");
            await sleep(MISMATCH_SEC);
            toggle(i, true);
            toggle(j, true);
        }
        firstPick = null;
        revealed.clear();
        lock = false;
        if (matched.size === deck.length) {
            for (let k = 0; k < deck.length; k++) {
                const f = cardEl(k).querySelector('.face');
                f.style.animation = 'none';
                f.offsetHeight; /* trigger reflow */
                f.style.animation = 'match-highlight 1s ease-out forwards';
                await sleep(0.2);
            }
            els.grid.classList.add("hidden");
            els.score.textContent = `All pairs matched in ${moves} moves.`;
            els.score.classList.add("visible");
            setStatus("");
            for (let k = 0; k < 7; k++) {
                runConfetti(Math.random() * window.innerWidth, Math.random() * window.innerHeight, 150);
                await sleep(0.6);
            }
        }
    }

    async function restart() {
        deck = newDeck();
        revealed.clear();
        matched.clear();
        firstPick = null;
        lock = false;
        moves = 0;
        updateMeta();
        render();
        els.grid.classList.remove("hidden");
        els.score.classList.remove("visible");

        deck.forEach((_, i) => toggle(i, false)); // Show all
        setStatus("Previewâ€¦");
        await sleep(PREVIEW_SEC);
        deck.forEach((_, i) => toggle(i, true)); // Hide all
        setStatus("Go!");
    }

    els.grid.addEventListener("click", e => {
        if (lock) return;
        const card = e.target.closest(".card");
        const idx = Number(card?.dataset.idx);
        if (!card || isNaN(idx) || matched.has(idx) || revealed.has(idx)) return;

        revealed.add(idx);
        toggle(idx, false);

        if (firstPick === null) firstPick = idx;
        else resolve(firstPick, idx);
    });

    document.getElementById("restartBtn").addEventListener("click", restart);
    document.addEventListener("contextmenu", e => e.preventDefault());
    restart();
</script>
</body>
</html>
